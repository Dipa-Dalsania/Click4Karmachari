@using ClickKarmachari;
@using ClickKarmachari.Models;
@{
    ViewBag.Title = "VoucherReq_List";
    Layout = "~/Views/Access/Access_Layout.cshtml";
    CommonClasses util = new CommonClasses();
    List<Voucher_Master> voucher = ViewBag.voucher;
    string imagerootpath = ViewBag.ImagekitDisplayURL;
    string imagepath = "";
}

<!--Page header-->
<div class="page-header d-xl-flex d-block">
    <div class="page-leftheader">
        <h4 class="page-title">All Voucher Request</h4>
    </div>
    <div class="page-rightheader ml-md-auto">
        <div class="align-items-end flex-wrap my-auto right-content breadcrumb-right">
            <div class="btn-list">
                <a href="~/Access/VoucherReq_Add?Voucher_Id=0" class="btn btn-primary mr-3"><i class="feather feather-plus fs-15 my-auto mr-2"></i><strong>Add Voucher</strong></a>
                <button id="approvebtn" type="button" onclick="return Getvoucherreqdata()" class="btn btn-success"><i class="fa fa-check"></i>Approve</button>
            </div>
        </div>
    </div>
</div>
<!--End Page header-->
<!-- Row -->
<div class="row">
    <div class="col-xl-12 col-md-12 col-lg-12">
        <div class="card">
            <div class="card-header  border-0">
                <h4 class="card-title"></h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-bordered text-nowrap border-bottom" id="basic-datatable">
                        <thead>
                            <tr>
                                <th></th>
                                <th class="border-bottom-0 text-center">Image</th>
                                <th class="border-bottom-0">Date</th>
                                <th class="border-bottom-0">Pay To</th>
                                <th class="border-bottom-0">Total Amount</th>
                                <th class="border-bottom-0">Payable/Receivable Amount</th>
                                <th class="border-bottom-0">Status</th>
                                <th class="border-bottom-0">Operation</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (voucher != null)
                            {
                                foreach (Voucher_Master p in voucher)
                                {
                                    <tr>
                                       
                                        <td><input type="checkbox" id="vouchercheckAll_@p.Voucher_Id" name="voucherreqchk" value="@p.Voucher_Id" /></td>
                                        @if (p.Image_Name == null)
                                        {
                                            <td><img class="avatar avatar-md brround mr-3" src="~/Uploads/User_Image/profile.jpg" target="_blank" alt="No Preview" height="40" width="60" /></td>
                                        }
                                        else
                                        {
                                            imagepath = imagerootpath + "/Voucher_Image/" + p.Image_Name;
                                            <td><a href="@imagepath" target="_blank"><img class="avatar avatar-md brround mr-3" src="@imagepath" target="_blank" alt="No Preview" height="40" width="60" onerror="this.src='@Url.Content("~/Uploads/User_Image/profile.jpg")';"/></a></td>
                                        }
                                        <td>@p.Voucher_Date.ToString("dd MMMM yyyy")</td>
                                        <td style="text-transform: capitalize">@p.UserMaster.User_Name</td>
                                        <td>@p.Total_Amount</td>
                                        <td>@p.Payable_Amount</td>
                                        <td>
                                            @*@util._Status_ByNumber(p.Status)*@
                                            @if (p.Status == 0)
                                            {
                                                <span class="badge badge-secondary-light"><b>@util._Status_ByNumber(p.Status)</b></span>
                                            }
                                            else if (p.Status == 1)
                                            {
                                                <span class="badge badge-success"><b>@util._Status_ByNumber(p.Status)</b></span>
                                            }
                                            else if (p.Status == 2)
                                            {
                                                <span class="badge badge-danger-light"><b>@util._Status_ByNumber(p.Status)</b></span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-primary-light"><b>@util._Status_ByNumber(p.Status)</b></span>
                                            }
                                        </td>
                                        <td>
                                            @if (p.Status != 1)
                                            {
                                                using (Ajax.BeginForm("VoucherReq_Delete", "Access", new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnUpdateAdminVoureq" }, new { @id = "form", @enctype = "multipart/form-data", role = "form" }))
                                                {
                                                    <input type="hidden" name="voucher_id" id="voucher_id" value="@p.Voucher_Id" />
                                                    <a href="~/Access/VoucherReq_Add?Voucher_Id=@p.Voucher_Id" class="btn btn-primary btn-icon"> <i class="feather feather-edit" data-toggle="tooltip" data-original-title="View/Edit"></i></a>
                                                    <Button type="submit" id="deletebtn" name="Command" value="Delete" class="btn btn-danger btn-icon" onclick="return confirm('Are you sure you want to Delete?')" ;><i class="feather feather-trash-2"></i></Button>
                                                }
                                            }
                                            else
                                            {
                                                <a href="~/Access/VoucherReq_Add?Voucher_Id=@p.Voucher_Id" style="color:none;border:none;background:none;"> <i class="fa fa-eye fa-2x text-primary"></i></a>
                                            }
                                        </td>
                                    </tr>
                                }
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- End Row-->
<script type="text/javascript">
    function Getvoucherreqdata() {

        let vouchermyList = [];
        let checkboxes = document.getElementsByName('voucherreqchk');
        let result = "";
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                /*result += checkboxes[i].value + ",";*/
                vouchermyList.push(checkboxes[i].value);

            }
        }


        $.ajax({

            url: '/Access/VoucherGetreqres',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(vouchermyList),
            success: function (data) {
                alert(data.msg);
                location.reload();
                },

            error: function (errormessage) {

            }
        });
    }
</script>